***************************************Food and Mortgage Data**********************************************************;
data food1968;
set psiddata.fam68;
id1968 = v3;
if v334 > 9990 then v334 = .;
food1968 = v334;
keep id1968  food1968;
proc univariate;
var food1968;
data food1969;
set psiddata.fam69;
id1969 = v442;
if v500 > 9990 then v500 = .;
if v506 > 9990 then v506 = .;
foodhome1969 = v500;
foodout1969 = v506;
food1969 = v500 + v506;
keep id1969  foodhome1969 foodout1969 food1969;
proc univariate;
var food1969;
data food1970;
set psiddata.fam70;
id1970 = v1102;
if v1175 > 9990 then v1175 = .;
if v1185 > 9990 then v1185 = .;
foodhome1970 = v1175;
foodout1970 = v1185;
food1970 = v1175 + v1185;
keep id1970 foodhome1970 foodout1970 food1970;
proc univariate;
var food1970;
data food1971;
set psiddata.fam71;
id1971 = v1802;
if v1876 > 9990 then v1876 = .;
if v1886 > 9990 then v1886 = .;
foodhome1971 = v1876;
foodout1971 = v1886;
food1971 = v1876 + v1886;
keep id1971 foodhome1971 foodout1971 food1971;
proc univariate;
var food1971;
data food1972;
set psiddata.fam72;
id1972 = v2402;
if v2476 > 9990 then v2476 = .;
if v2480 > 9990 then v2480 = .;
foodhome1972 = v2476;
foodout1972 = v2480;
food1972 = v2476 + v2480;
keep id1972 foodhome1972 foodout1972 food1972;
proc univariate;
var food1972;
data food1974;
set psiddata.fam74;
id1974 = v3402;
if v3441 > 9990 then v3441 = .;
if v3445 > 9990 then v3445 = .;
foodhome1974 = v3441;
foodout1974 = v3445;
food1974 = v3441 + v3445;
keep id1974 foodhome1974 foodout1974 food1974;
proc univariate;
var food1974;
data food1975;
set psiddata.fam75;
id1975 = v3802;
if v3841 > 9990 then v3841 = .;
if v3853 > 9990 then v3853 = .;
foodhome1975 = v3841;
foodout1975 = v3853;
food1975 = v3841 + V3853;
keep id1975 foodhome1975 foodout1975 food1975;
proc univariate;
var food1975;
data food1976;
set psiddata.fam76;
id1976 = v4302;
if v4354 > 9990 then v4354 = .;
if v4368 > 9990 then v4368 = .;
foodhome1976 = v4354;
foodout1976 = v4368;
food1976 = V4354+v4368;
keep id1976 foodhome1976 foodout1976 food1976;
proc univariate;
var food1976;
data food1977;
set psiddata.fam77;
id1977 = v5202;
if v5271 > 9990 then v5271 = .;
if v5273 > 9990 then v5273 = .;
foodhome1977 = v5271;
foodout1977 = v5273;
food1977 = v5271 + V5273;
keep id1977 foodhome1977 foodout1977 food1977;
proc univariate;
var food1977;
data food1978;
set psiddata.fam78;
id1978 = v5702;
if v5770 > 9990 then v5770 = .;
if v5772 > 9990 then v5772 = .;
foodhome1978 = v5770;
foodout1978 = v5772;
food1978 = v5770 + v5772;
keep id1978 foodhome1978 foodout1978 food1978;
proc univariate;
var food1978;
data food1979;
set psiddata.fam79;
id1979 = v6302;
if v6376 > 9990 then v6376 = .;
if v6378 > 9990 then v6378 = .;
foodhome1979 = v6376;
foodout1979 = v6378;
food1979 = v6376 + v6378;
keep id1979 foodhome1979 foodout1979 food1979;
proc univariate;
var food1979;
data food1980;
set psiddata.fam80;
id1980 = v6902;
if v6972 > 9990 then v6972 = .;
if v6974 > 9990 then v6974 = .;
foodhome1980 = v6972;
foodout1980 = v6974;
food1980 = v6972 + v6974;
keep id1980 foodhome1980 foodout1980 food1980;
proc univariate;
var food1980;
data food1981;
set psiddata.fam81;
id1981 = v7502;
if v7564 > 9990 then v7564 = .;
if v7566 > 9990 then v7566 = .;
foodhome1981 = v7564;
foodout1981 = v7566;
food1981 = v7564 + v7566;
keep id1981 foodhome1981 foodout1981 food1981;
proc univariate;
var food1981;
data food1982;
set psiddata.fam82;
id1982 = v8202;
if v8256 > 9990 then v8256 = .;
if v8258 > 9990 then v8258 = .;
foodhome1982 = v8256;
foodout1982 = v8258;
food1982 = v8256 + v8258;
keep id1982  foodhome1982 foodout1982 food1982;
proc univariate;
var food1982;
data food1983;
set psiddata.fam83;
id1983 = v8802;
if v8866 > 9990 then v8866 = .;
foodhome1983 = v8864;
foodout1983 = v8866;
food1983 = v8864 + v8866;
keep id1983 foodhome1983 foodout1983 food1983;
proc univariate;
var food1983;
data food1984;
set psiddata.fam84;
id1984 = v10002;
if v10237 > 9990 then v10237 = .;
foodhome1984 = v10235;
foodout1984 = v10237;
food1984 = v10235 + v10237;
keep id1984 foodhome1984 foodout1984 food1984;
proc univariate;
var food1984;
data food1985;
set psiddata.fam85;
id1985 = v11102;
if v11377 > 9990 then v11377 = .;
foodhome1985 = v11375;
foodout1985 = v11377;
food1985 = v11375 + v11377;
keep id1985 foodhome1985 foodout1985 food1985;
proc univariate;
var food1985;
data food1986;
set psiddata.fam86;
id1986 = v12502;
if v12776 > 9990 then v12776 = .;
foodhome1986 = v12774;
foodout1986 = v12776;
food1986 = v12774 + v12776;
keep id1986 foodhome1986 foodout1986 food1986;
proc univariate;
var food1986;
data food1987;
set psiddata.fam87;
id1987 = v13702;
if v13878 > 9990 then v13878 = .;
foodhome1987 = v13876;
foodout1987 = v13878;
food1987 = v13876 + v13878;
keep id1987 foodhome1987 foodout1987 food1987;
proc univariate;
var food1987;
data food1990;
set psiddata.fam90;
id1990 = v17702;
if v17809 > 9990 then v17809 = .;
foodhome1990 = v17807;
foodout1990= v17809;
food1990 = v17807 + v17809;
keep id1990 foodhome1990 foodout1990 food1990;
proc univariate;
var food1990;
data food1991;
set psiddata.fam91;
id1991 = v19002;
if v19109 > 9990 then v19109 = .;
foodhome1991 = v19107;
foodout1991 = v19109;
food1991 = v19107 + v19109;
keep id1991 foodhome1991 foodout1991 food1991;
proc univariate;
var food1991;
data food1992;
set psiddata.fam92;
id1992 = v20302;
if v20409 > 9990 then v20409 = .;
foodhome1992 = v20407;
foodout1992 = v20409;
food1992 = v20407 + v20409;
keep id1992 foodhome1992 foodout1992 food1992;
proc univariate;
var food1992;
data food1993;
set psiddata.fam93;
id1993 = v21602;
if v21711 > 9990 then v21711 = .;
foodhome1993 = v21707;
foodout1993 = v21711;
food1993 = v21707 + v21711;
keep id1993 foodhome1993 foodout1993 food1993;
proc univariate;
var food1993;

*************************************************************************************************************************;

%macro food;
if fdhm >= 99997 then fdhm = .;
if fdout >= 99997 then fdout = .;
if hmper = 3 and fdhm>1000 then fdhm=.;    
if hmper = 3 then fdhm = fdhm*52;
if hmper = 4 then fdhm = fdhm*26;
if hmper = 5 then fdhm = fdhm*12;
if hmper = 7 then fdhm = .;
if outper = 3 then fdout = fdout*52;
if outper = 4 then fdout = fdout*26;
if outper = 5 then fdout = fdout*12;
if outper = 7 then fdout = .;
if fdhm > 50000 then fdhm = .;
if fdout > 50000 then fdout = .;
food = fdhm + fdout;
%mend;

data food1994;
set psiddata.fam94;
id1994 = ER2002;
if ER3078 ne 0 then do; fdhm = ER3078; hmper = ER3079; end;
else do; fdhm = ER3085; hmper = ER3086; end;
if ER3083 ne 0 then do; fdout = ER3083; outper = ER3084;  end;
else do; fdout = ER3090; outper = ER3091; end;
if fdhm > 99996 then fdhm = .;
if fdout > 99996 then fdout = .;
if hmper = 1 then fdhm = fdhm * 52;
else if hmper = 2 then fdhm = fdhm * 26;
else if hmper = 3 then fdhm = fdhm * 12;
else fdhm = .;
if outper = 1 then fdout = fdout * 52;
else if outper = 2 then fdout = fdout * 26;
else if outper = 3 then fdout = fdout * 12;
else fdout = .;
if fdhm > 50000 then fdhm = .;
if fdout > 50000 then fdout = .;
foodhome1994 = fdhm;
foodout1994 = fdout;
food1994 = fdhm + fdout;
keep id1994 foodhome1994 foodout1994 food1994;
proc univariate;
var food1994;

data food1995;
set psiddata.fam95;
id1995 = ER5002;
if ER6077 ne 0 then do; fdhm = ER6077; hmper = ER6078; end;
else do; fdhm = ER6084; hmper = ER6085; end;
if ER6082 ne 0 then do; fdout = ER6082; outper = ER6083;  end;
else do; fdout = ER6089; outper = ER6090; end;
%food;
foodhome1995 = fdhm;
foodout1995 = fdout;
food1995 = food;
keep id1995 foodhome1995 foodout1995 food1995;
proc univariate;
var food1995;

data food1996;
set psiddata.fam96;
id1996 = ER7002;
if ER8174 ne 0 then do; fdhm = ER8174; hmper = ER8175; end;
else do; fdhm = ER8181; hmper = ER8182; end;
if ER8179 ne 0 then do; fdout = ER8179; outper = ER8180;  end;
else do; fdout = ER8186; outper = ER8187; end;
%food;
foodhome1996 = fdhm;
foodout1996 = fdout;
food1996 = food;
keep id1996 foodhome1996 foodout1996 food1996;
proc univariate;
var food1996;

data food1997;
set psiddata.fam97;
id1997 = ER10002;
if ER11068 ne 0 then do; fdhm = ER11068; hmper = ER11069; end;
else do; fdhm = ER11076; hmper = ER11077; end;
if ER11073 ne 0 then do; fdout = ER11073; outper = ER11074;  end;
else do; fdout = ER11081; outper = ER11082; end;
%food;
foodhome1997 = fdhm;
foodout1997 = fdout;
food1997 = food;
keep id1997 foodhome1997 foodout1997 food1997;
proc univariate;
var food1997;


************************************************************************************************************************;
libname pc 'c:\project\cexpsidnew\psid';
data food1999;
set pc.pc1999impute;
food1999 = food - fooddel;
foodhome1999 = foodhm; 
foodout1999 = foodout;
keep id1999 foodhome1999 foodout1999 food1999;
proc univariate;
var food1999;

data food2001;
set pc.pc2001impute;
food2001 = food - fooddel;
foodhome2001 = foodhm;
foodout2001 = foodout;
keep id2001 foodhome2001 foodout2001 food2001;
proc univariate;
var food2001;

data food2003;
set pc.pc2003impute;
food2003 = food - fooddel;
foodhome2003 = foodhm;
foodout2003 = foodout;
keep id2003 foodhome2003 foodout2003 food2003;
proc univariate;
var food2003;
run;

data psiddata.psidfood19682003;
merge food1968 food1969 food1970 food1971 food1972 food1974 food1975 food1976 food1977 food1978 food1979 
      food1980 food1981 food1982 food1983 food1984 food1985 food1986 food1987 
	  food1990 food1991 food1992 food1993 food1994 food1995 food1996 food1997 food1999
	  food2001 food2003;
run;

%macro pfood(year);
data pfood;
set psiddata.psidfood19682003;
if id&year ne .;
if food&year > 0;
proc univariate;
var food&year;
run;
%mend;
%pfood(1993)
%pfood(1994)
%pfood(1995)
%pfood(1996)
%pfood(1997)
%pfood(1999)
